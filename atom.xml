<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://blog.cyanzoy.top</id>
    <title>MAOA-L</title>
    <updated>2019-09-29T07:00:34.204Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://blog.cyanzoy.top"/>
    <link rel="self" href="https://blog.cyanzoy.top/atom.xml"/>
    <subtitle>ä¸ºæŠ€æœ¯è€Œç”Ÿ</subtitle>
    <logo>https://blog.cyanzoy.top/images/avatar.png</logo>
    <icon>https://blog.cyanzoy.top/favicon.ico</icon>
    <rights>All rights reserved 2019, MAOA-L</rights>
    <entry>
        <title type="html"><![CDATA[Nginxå®‰è£…]]></title>
        <id>https://blog.cyanzoy.top/post/NzkqO5w9Y</id>
        <link href="https://blog.cyanzoy.top/post/NzkqO5w9Y">
        </link>
        <updated>2019-09-27T09:02:15.000Z</updated>
        <summary type="html"><![CDATA[<p>ç®€ä»‹è®°å½•nginxçš„å®‰è£…</p>
]]></summary>
        <content type="html"><![CDATA[<p>ç®€ä»‹è®°å½•nginxçš„å®‰è£…</p>
<!-- more -->
<h1 id="éœ€è¦çš„ä¾èµ–ç¯å¢ƒ">éœ€è¦çš„ä¾èµ–ç¯å¢ƒ</h1>
<pre><code>yum -y install pcre pcre-devel
yum install openssl openssl-devel
</code></pre>
<h1 id="ç¼–è¯‘-å®‰è£…">ç¼–è¯‘ &amp;&amp; å®‰è£…</h1>
<pre><code>./configure --prefix=/usr/local/nginx --with-http_ssl_module
make &amp;&amp; make install
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ•°æ®åº“]]></title>
        <id>https://blog.cyanzoy.top/post/LfyAN6ymf</id>
        <link href="https://blog.cyanzoy.top/post/LfyAN6ymf">
        </link>
        <updated>2019-09-23T07:59:06.000Z</updated>
        <summary type="html"><![CDATA[<p>ä¸€ç³»åˆ—å‘½ä»¤</p>
]]></summary>
        <content type="html"><![CDATA[<p>ä¸€ç³»åˆ—å‘½ä»¤</p>
<!-- more -->
<h1 id="åˆ›å»ºç”¨æˆ·æˆæƒè®¾æ›´æ”¹åŠ å¯†æ¨¡å¼">åˆ›å»ºç”¨æˆ·ï¼Œæˆæƒï¼Œè®¾æ›´æ”¹åŠ å¯†æ¨¡å¼</h1>
<h1 id="åˆ›å»ºè´¦å·">åˆ›å»ºè´¦å·</h1>
<pre><code>CREATE USER 'username'@'host' IDENTIFIED BY 'password';
</code></pre>
<h1 id="æˆæƒ">æˆæƒ</h1>
<pre><code>GRANT privileges ON databasename.tablename TO 'username'@'host'
GRANT ALL ON databasename.* TO 'username'@'host'
è¯´æ˜:
# privilegesï¼šç”¨æˆ·çš„æ“ä½œæƒé™ï¼Œå¦‚SELECTï¼ŒINSERTï¼ŒUPDATEç­‰ï¼Œå¦‚æœè¦æˆäºˆæ‰€çš„æƒé™åˆ™ä½¿ç”¨ALL 
# databasenameï¼šæ•°æ®åº“å
# tablenameï¼šè¡¨åï¼Œå¦‚æœè¦æˆäºˆè¯¥ç”¨æˆ·å¯¹æ‰€æœ‰æ•°æ®åº“å’Œè¡¨çš„ç›¸åº”æ“ä½œæƒé™åˆ™å¯ç”¨è¡¨ç¤ºï¼Œå¦‚.*
</code></pre>
<pre><code>æ³¨æ„:
ç”¨ä»¥ä¸Šå‘½ä»¤æˆæƒçš„ç”¨æˆ·ä¸èƒ½ç»™å…¶å®ƒç”¨æˆ·æˆæƒï¼Œå¦‚æœæƒ³è®©è¯¥ç”¨æˆ·å¯ä»¥æˆæƒï¼Œç”¨ä»¥ä¸‹å‘½ä»¤:
GRANT privileges ON databasename.tablename TO 'username'@'host' WITH GRANT OPTION;
</code></pre>
<h1 id="è®¾ç½®ä¸æ›´æ”¹ç”¨æˆ·å¯†ç ">è®¾ç½®ä¸æ›´æ”¹ç”¨æˆ·å¯†ç </h1>
<pre><code>å‘½ä»¤:
SET PASSWORD FOR 'username'@'host' = PASSWORD('newpassword');
å¦‚æœæ˜¯å½“å‰ç™»é™†ç”¨æˆ·ç”¨:
SET PASSWORD = PASSWORD(&quot;newpassword&quot;);
ä¾‹å­:
SET PASSWORD FOR 'pig'@'%' = PASSWORD(&quot;123456&quot;);
</code></pre>
<h1 id="æ’¤é”€ç”¨æˆ·æƒé™">æ’¤é”€ç”¨æˆ·æƒé™</h1>
<pre><code>REVOKE privilege ON databasename.tablename FROM 'username'@'host';
è¯´æ˜:
privilege, databasename, tablenameï¼šåŒæˆæƒéƒ¨åˆ†
ä¾‹å­:
REVOKE SELECT ON *.* FROM 'pig'@'%';
å‡å¦‚ä½ åœ¨ç»™ç”¨æˆ· 'pig'@ '%'æˆæƒçš„æ—¶å€™æ˜¯è¿™æ ·çš„ï¼ˆæˆ–ç±»ä¼¼çš„ï¼‰ï¼šGRANT SELECT ON test.user TO 'pig'@'%'ï¼Œåˆ™åœ¨ä½¿ç”¨REVOKE SELECT ON . FROM 'pig'@'%';å‘½ä»¤å¹¶ä¸èƒ½æ’¤é”€è¯¥ç”¨æˆ·å¯¹testæ•°æ®åº“ä¸­userè¡¨çš„SELECT æ“ä½œã€‚
åŒç†ï¼Œå¦‚æœæˆæƒä½¿ç”¨çš„æ˜¯GRANT SELECT ON . TO 'pig'@'%';åˆ™REVOKE SELECT ON test.user FROM 'pig'@'%';å‘½ä»¤ä¹Ÿä¸èƒ½æ’¤é”€è¯¥ç”¨æˆ·å¯¹testæ•°æ®åº“ä¸­userè¡¨çš„Selectæƒé™ã€‚
å…·ä½“ä¿¡æ¯å¯ä»¥ç”¨å‘½ä»¤SHOW GRANTS FOR 'pig'@'%'; æŸ¥çœ‹ã€‚
</code></pre>
<h1 id="åˆ é™¤ç”¨æˆ·">åˆ é™¤ç”¨æˆ·</h1>
<pre><code>DROP USER 'username'@'host';
</code></pre>
<h1 id="mysql8-åŠ å¯†æ–¹å¼ä¸åŒå¦‚æœ‰éœ€è¦å¯è¿è¡Œä¸‹é¢è¿™å¥è¿›è¡Œæ›´æ”¹">mysql8 åŠ å¯†æ–¹å¼ä¸åŒï¼Œå¦‚æœ‰éœ€è¦å¯è¿è¡Œä¸‹é¢è¿™å¥è¿›è¡Œæ›´æ”¹</h1>
<pre><code>ALTER USER 'tone'@'%' IDENTIFIED WITH mysql_native_password BY '123456';
FLUSH PRIVILEGES; 
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[åç«¯å¿…å¤‡ Nginx é…ç½®]]></title>
        <id>https://blog.cyanzoy.top/post/9XwZQILat</id>
        <link href="https://blog.cyanzoy.top/post/9XwZQILat">
        </link>
        <updated>2019-09-19T02:55:54.000Z</updated>
        <summary type="html"><![CDATA[<ul>
<li>é˜²ç›—é“¾</li>
<li>æ ¹æ®æ–‡ä»¶ç±»å‹è®¾ç½®è¿‡æœŸæ—¶é—´</li>
<li>é™æ€èµ„æºè®¿é—®</li>
<li>æ—¥å¿—é…ç½®</li>
<li>æ—¥å¿—å­—æ®µè¯´æ˜</li>
<li>access_log è®¿é—®æ—¥å¿—</li>
<li>error_log æ—¥å¿—</li>
<li>æ—¥å¿—åˆ‡å‰²</li>
<li>åå‘ä»£ç†</li>
<li>ç¦æ­¢æŒ‡å®šuser_agent</li>
<li>nginxè®¿é—®æ§åˆ¶</li>
<li>è´Ÿè½½å‡è¡¡</li>
</ul>
]]></summary>
        <content type="html"><![CDATA[<ul>
<li>é˜²ç›—é“¾</li>
<li>æ ¹æ®æ–‡ä»¶ç±»å‹è®¾ç½®è¿‡æœŸæ—¶é—´</li>
<li>é™æ€èµ„æºè®¿é—®</li>
<li>æ—¥å¿—é…ç½®</li>
<li>æ—¥å¿—å­—æ®µè¯´æ˜</li>
<li>access_log è®¿é—®æ—¥å¿—</li>
<li>error_log æ—¥å¿—</li>
<li>æ—¥å¿—åˆ‡å‰²</li>
<li>åå‘ä»£ç†</li>
<li>ç¦æ­¢æŒ‡å®šuser_agent</li>
<li>nginxè®¿é—®æ§åˆ¶</li>
<li>è´Ÿè½½å‡è¡¡</li>
</ul>
<!-- more -->
<h2 id="é˜²ç›—é“¾">é˜²ç›—é“¾</h2>
<pre><code>location ~* \.(gif|jpg|png)$ {
    # åªå…è®¸ 192.168.0.1 è¯·æ±‚èµ„æº
    valid_referers none blocked 192.168.0.1;
    if ($invalid_referer) {
       rewrite ^/ http://$host/logo.png;
    }
}
</code></pre>
<h2 id="æ ¹æ®æ–‡ä»¶ç±»å‹è®¾ç½®è¿‡æœŸæ—¶é—´">æ ¹æ®æ–‡ä»¶ç±»å‹è®¾ç½®è¿‡æœŸæ—¶é—´</h2>
<pre><code>location ~.*\.css$ {
    expires 1d;
    break;
}
location ~.*\.js$ {
    expires 1d;
    break;
}
location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$ {
    access_log off;
    expires 15d;    #ä¿å­˜15å¤©
    break;
}

# curl -x127.0.0.1:80 http://www.test.com/static/image/common/logo.png -I #
æµ‹è¯•å›¾ç‰‡çš„max-age
</code></pre>
<h2 id="é™æ€èµ„æºè®¿é—®">é™æ€èµ„æºè®¿é—®</h2>
<pre><code>http {
    # è¿™ä¸ªå°†ä¸ºæ‰“å¼€æ–‡ä»¶æŒ‡å®šç¼“å­˜ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰å¯ç”¨çš„ï¼Œmax æŒ‡å®šç¼“å­˜æ•°é‡ï¼Œ
    # å»ºè®®å’Œæ‰“å¼€æ–‡ä»¶æ•°ä¸€è‡´ï¼Œinactive æ˜¯æŒ‡ç»è¿‡å¤šé•¿æ—¶é—´æ–‡ä»¶æ²¡è¢«è¯·æ±‚ååˆ é™¤ç¼“å­˜ã€‚
    open_file_cache max=204800 inactive=20s;

    # open_file_cache æŒ‡ä»¤ä¸­çš„inactive å‚æ•°æ—¶é—´å†…æ–‡ä»¶çš„æœ€å°‘ä½¿ç”¨æ¬¡æ•°ï¼Œ
    # å¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œæ–‡ä»¶æè¿°ç¬¦ä¸€ç›´æ˜¯åœ¨ç¼“å­˜ä¸­æ‰“å¼€çš„ï¼Œå¦‚ä¸Šä¾‹ï¼Œå¦‚æœæœ‰ä¸€ä¸ª
    # æ–‡ä»¶åœ¨inactive æ—¶é—´å†…ä¸€æ¬¡æ²¡è¢«ä½¿ç”¨ï¼Œå®ƒå°†è¢«ç§»é™¤ã€‚
    open_file_cache_min_uses 1;

    # è¿™ä¸ªæ˜¯æŒ‡å¤šé•¿æ—¶é—´æ£€æŸ¥ä¸€æ¬¡ç¼“å­˜çš„æœ‰æ•ˆä¿¡æ¯
    open_file_cache_valid 30s;

    # é»˜è®¤æƒ…å†µä¸‹ï¼ŒNginxçš„gzipå‹ç¼©æ˜¯å…³é—­çš„ï¼Œ gzipå‹ç¼©åŠŸèƒ½å°±æ˜¯å¯ä»¥è®©ä½ èŠ‚çœä¸
    # å°‘å¸¦å®½ï¼Œä½†æ˜¯ä¼šå¢åŠ æœåŠ¡å™¨CPUçš„å¼€é”€å“¦ï¼ŒNginxé»˜è®¤åªå¯¹text/htmlè¿›è¡Œå‹ç¼© ï¼Œ
    # å¦‚æœè¦å¯¹htmlä¹‹å¤–çš„å†…å®¹è¿›è¡Œå‹ç¼©ä¼ è¾“ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ¥è®¾ç½®ã€‚
    gzip on;
    gzip_min_length 1k;
    gzip_buffers 4 16k;
    gzip_http_version 1.0;
    gzip_comp_level 2;
    gzip_types text/plain application/x-javascript text/css application/xml;


    server {
        listen       80;
        server_name www.test.com;
        charset utf-8;
        root   /data/www.test.com;
        index  index.html index.htm;
    }
}
</code></pre>
<h2 id="æ—¥å¿—é…ç½®">æ—¥å¿—é…ç½®</h2>
<h3 id="æ—¥å¿—å­—æ®µè¯´æ˜">æ—¥å¿—å­—æ®µè¯´æ˜</h3>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>remote_addr å’Œ http_x_forwarded_for</td>
<td>å®¢æˆ·ç«¯ IP åœ°å€</td>
</tr>
<tr>
<td>remote_user</td>
<td>å®¢æˆ·ç«¯ç”¨æˆ·åç§°</td>
</tr>
<tr>
<td>request</td>
<td>è¯·æ±‚çš„ URI å’Œ HTTP åè®®</td>
</tr>
<tr>
<td>status</td>
<td>è¯·æ±‚çŠ¶æ€</td>
</tr>
<tr>
<td>body_bytes_sent</td>
<td>è¿”å›ç»™å®¢æˆ·ç«¯çš„å­—èŠ‚æ•°ï¼Œä¸åŒ…æ‹¬å“åº”å¤´çš„å¤§å°</td>
</tr>
<tr>
<td>bytes_sent</td>
<td>è¿”å›ç»™å®¢æˆ·ç«¯æ€»å­—èŠ‚æ•°</td>
</tr>
<tr>
<td>connection</td>
<td>è¿æ¥çš„åºåˆ—å·</td>
</tr>
<tr>
<td>connection_requests</td>
<td>å½“å‰åŒä¸€ä¸ª TCP è¿æ¥çš„çš„è¯·æ±‚æ•°é‡</td>
</tr>
<tr>
<td>msec</td>
<td>æ—¥å¿—å†™å…¥æ—¶é—´ã€‚å•ä½ä¸ºç§’ï¼Œç²¾åº¦æ˜¯æ¯«ç§’</td>
</tr>
<tr>
<td>pipe</td>
<td>å¦‚æœè¯·æ±‚æ˜¯é€šè¿‡HTTPæµæ°´çº¿(pipelined)å‘é€ï¼Œpipeå€¼ä¸º&quot;p&quot;ï¼Œå¦åˆ™ä¸º&quot;.&quot;</td>
</tr>
<tr>
<td>http_referer</td>
<td>è®°å½•ä»å“ªä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„</td>
</tr>
<tr>
<td>http_user_agent</td>
<td>è®°å½•å®¢æˆ·ç«¯æµè§ˆå™¨ç›¸å…³ä¿¡æ¯</td>
</tr>
<tr>
<td>request_length</td>
<td>è¯·æ±‚çš„é•¿åº¦(åŒ…æ‹¬è¯·æ±‚è¡Œï¼Œè¯·æ±‚å¤´å’Œè¯·æ±‚æ­£æ–‡)</td>
</tr>
<tr>
<td>time_iso8601</td>
<td>ISO8601æ ‡å‡†æ ¼å¼ä¸‹çš„æœ¬åœ°æ—¶é—´</td>
</tr>
<tr>
<td>time_local</td>
<td>è®°å½•è®¿é—®æ—¶é—´ä¸æ—¶åŒº</td>
</tr>
</tbody>
</table>
<h2 id="access_log-è®¿é—®æ—¥å¿—">access_log è®¿é—®æ—¥å¿—</h2>
<pre><code>http {
    log_format  access  '$remote_addr - $remote_user [$time_local] $host &quot;$request&quot; '
                  '$status $body_bytes_sent &quot;$http_referer&quot; '
                  '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot; &quot;$clientip&quot;';
    access_log  /srv/log/nginx/talk-fun.access.log  access;
}
</code></pre>
<h2 id="error_log-æ—¥å¿—">error_log æ—¥å¿—</h2>
<pre><code>error_log  /srv/log/nginx/nginx_error.log  error;
# error_log /dev/null; # çœŸæ­£çš„å…³é—­é”™è¯¯æ—¥å¿—
http {
    # ...
}
</code></pre>
<h2 id="æ—¥å¿—åˆ‡å‰²">æ—¥å¿—åˆ‡å‰²</h2>
<pre><code># å’Œapacheä¸åŒçš„æ˜¯ï¼Œnginxæ²¡æœ‰apacheä¸€æ ·çš„å·¥å…·åšåˆ‡å‰²ï¼Œéœ€è¦ç¼–å†™è„šæœ¬å®ç°ã€‚# åœ¨/usr/local/sbinä¸‹å†™è„šæœ¬

#!/bin/bash
dd=$(date -d '-1 day' +%F)[ -d /tmp/nginx_log ] || mkdir /tmp/nginx_log
mv /tmp/nginx_access.log /tmp/nginx_log/$dd.log
/etc/init.d/nginx reload &gt; /dev/null
</code></pre>
<h2 id="åå‘ä»£ç†">åå‘ä»£ç†</h2>
<pre><code>http {
    include mime.types;
    server_tokens off;

    ## é…ç½®åå‘ä»£ç†çš„å‚æ•°
    server {
        listen    8080;

        ## 1. ç”¨æˆ·è®¿é—® http://ip:portï¼Œåˆ™åå‘ä»£ç†åˆ° https://github.com
        location / {
            proxy_pass  https://github.com;
            proxy_redirect     off;
            proxy_set_header   Host             $host;
            proxy_set_header   X-Real-IP        $remote_addr;
            proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
        }

        ## 2.ç”¨æˆ·è®¿é—® http://ip:port/README.mdï¼Œåˆ™åå‘ä»£ç†åˆ°
        ##   https://github.com/zibinli/blog/blob/master/README.md
        location /README.md {
            proxy_set_header  X-Real-IP  $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_pass https://github.com/zibinli/blog/blob/master/README.md;
        }
    }
}
</code></pre>
<h2 id="ç¦æ­¢æŒ‡å®šuser_agent">ç¦æ­¢æŒ‡å®šuser_agent</h2>
<pre><code>#è™šæ‹Ÿä¸»æœºçš„é…ç½®æ–‡ä»¶é‡ŒåŠ å…¥ï¼š
if ($http_user_agent ~* 'baidu|360|sohu') #ç¦æ­¢useragentä¸ºbaiduã€360å’Œsohuï¼Œ~*è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™åŒ¹é…
{
   return 403;
}

location /  å’Œ  location  ~ /  ä¼˜å…ˆçº§æ˜¯ä¸ä¸€æ ·çš„ã€‚ 
ç»“åˆè¿™ä¸ªæ–‡ç« ç ”ç©¶ä¸€ä¸‹å§ http://blog.itpub.net/27181165/viewspace-777202/
curl -A &quot;baidu&quot; -x127.0.0.1:80 www.test.com/forum.php -I    è¯¥å‘½ä»¤æŒ‡å®šç™¾åº¦ä¸ºuser_agent,è¿”å›403
</code></pre>
<h2 id="nginxè®¿é—®æ§åˆ¶">nginxè®¿é—®æ§åˆ¶</h2>
<pre><code># å¯ä»¥è®¾ç½®ä¸€äº›é…ç½®ç¦æ­¢ä¸€äº›ipçš„è®¿é—®

deny 127.0.0.1;     #å…¨å±€å®šä¹‰é™åˆ¶ï¼Œlocationé‡Œçš„æ˜¯å±€éƒ¨å®šä¹‰çš„ã€‚å¦‚æœä¸¤è€…å†²çªï¼Œä»¥locationè¿™ç§ç²¾ç¡®åœ°ä¼˜å…ˆï¼Œ

location ~ .*admin\.php$ {
    #auth_basic &quot;cct auth&quot;;
    #auth_basic_user_file /usr/local/nginx/conf/.htpasswd;

    allow 127.0.0.1;  åªå…è®¸127.0.0.1çš„è®¿é—®ï¼Œå…¶ä»–å‡æ‹’ç»
    deny all;

    include fastcgi_params;
    fastcgi_pass unix:/tmp/www.sock;
    fastcgi_index index.php;
    fastcgi_param SCRIPT_FILENAME /data/www$fastcgi_script_name;
}
</code></pre>
<h2 id="è´Ÿè½½å‡è¡¡">è´Ÿè½½å‡è¡¡</h2>
<pre><code>http {
    upstream test.net {
        ip_hash;
        server 192.168.10.13:80;
        server 192.168.10.14:80  down;
        server 192.168.10.15:8009  max_fails=3  fail_timeout=20s;
        server 192.168.10.16:8080;
    }
    server {
        location / {
            proxy_pass  http://test.net;
        }
    }
}
</code></pre>
<h1 id="nginxçš„rewrite">Nginxçš„rewrite</h1>
<h2 id="rewite">rewite</h2>
<p>åœ¨<code>server</code>å—ä¸‹ï¼Œä¼šä¼˜å…ˆæ‰§è¡Œ<code>rewrite</code>éƒ¨åˆ†ï¼Œç„¶åæ‰ä¼šå»åŒ¹é…<code>location</code>å—<br>
<code>server</code>ä¸­çš„<code>rewrite break</code>å’Œ<code>last</code>æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œéƒ½ä¼šå»åŒ¹é…<code>location</code>ï¼Œæ‰€ä»¥æ²¡å¿…è¦ç”¨<code>last</code>å†å‘èµ·æ–°çš„è¯·æ±‚ï¼Œå¯ä»¥ç•™ç©º</p>
<h2 id="locationä¸­çš„rewirte">locationä¸­çš„rewirteï¼š</h2>
<p>ä¸å†™lastå’Œbreak - é‚£ä¹ˆæµç¨‹å°±æ˜¯ä¾æ¬¡æ‰§è¡Œè¿™äº›rewrite</p>
<ol>
<li><code>rewrite break</code> - urlé‡å†™åï¼Œç›´æ¥ä½¿ç”¨å½“å‰èµ„æºï¼Œä¸å†æ‰§è¡Œlocationé‡Œä½™ä¸‹çš„è¯­å¥ï¼Œå®Œæˆæœ¬æ¬¡è¯·æ±‚ï¼Œåœ°å€æ urlä¸å˜</li>
<li><code>rewrite last</code> - urlé‡å†™åï¼Œé©¬ä¸Šå‘èµ·ä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼Œå†æ¬¡è¿›å…¥serverå—ï¼Œé‡è¯•locationåŒ¹é…ï¼Œè¶…è¿‡10æ¬¡åŒ¹é…ä¸åˆ°æŠ¥500é”™è¯¯ï¼Œåœ°å€æ urlä¸å˜</li>
<li><code>rewrite redirect</code> â€“ è¿”å›302ä¸´æ—¶é‡å®šå‘ï¼Œåœ°å€æ æ˜¾ç¤ºé‡å®šå‘åçš„urlï¼Œçˆ¬è™«ä¸ä¼šæ›´æ–°urlï¼ˆå› ä¸ºæ˜¯ä¸´æ—¶ï¼‰</li>
<li><code>rewrite permanent</code> â€“ è¿”å›301æ°¸ä¹…é‡å®šå‘, åœ°å€æ æ˜¾ç¤ºé‡å®šå‘åçš„urlï¼Œçˆ¬è™«æ›´æ–°url</li>
</ol>
<h2 id="ä½¿ç”¨lastä¼šå¯¹serveræ ‡ç­¾é‡æ–°å‘èµ·è¯·æ±‚">ä½¿ç”¨lastä¼šå¯¹serveræ ‡ç­¾é‡æ–°å‘èµ·è¯·æ±‚</h2>
<ul>
<li>å¦‚æœlocationä¸­rewriteåæ˜¯å¯¹é™æ€èµ„æºçš„è¯·æ±‚ï¼Œä¸éœ€è¦å†è¿›è¡Œå…¶ä»–åŒ¹é…ï¼Œä¸€èˆ¬è¦ä½¿ç”¨breakæˆ–ä¸å†™ï¼Œç›´æ¥ä½¿ç”¨å½“å‰locationä¸­çš„æ•°æ®æºï¼Œå®Œæˆæœ¬æ¬¡è¯·æ±‚</li>
<li>å¦‚æœlocationä¸­rewriteåï¼Œè¿˜éœ€è¦è¿›è¡Œå…¶ä»–å¤„ç†ï¼Œå¦‚åŠ¨æ€fastcgiè¯·æ±‚(.php,.jsp)ç­‰ï¼Œè¦ç”¨lastç»§ç»­å‘èµ·æ–°çš„è¯·æ±‚</li>
<li>(æ ¹çš„locationä½¿ç”¨lastæ¯”è¾ƒå¥½, å› ä¸ºå¦‚æœæœ‰.phpç­‰fastcgiè¯·æ±‚è¿˜è¦ç»§ç»­å¤„ç†)</li>
<li>ä½¿ç”¨aliasæŒ‡å®šæºï¼šå¿…é¡»ä½¿ç”¨last</li>
<li>ifè¯­å¥ä¸»è¦ç”¨æ¥åˆ¤æ–­ä¸€äº›åœ¨rewriteè¯­å¥ä¸­æ— æ³•ç›´æ¥åŒ¹é…çš„æ¡ä»¶,æ¯”å¦‚æ£€æµ‹æ–‡ä»¶å­˜åœ¨ä¸å¦,http header,cookieç­‰</li>
</ul>
<h2 id="locationåŒ¹é…è§„åˆ™åŠä¼˜å…ˆçº§">locationåŒ¹é…è§„åˆ™åŠä¼˜å…ˆçº§</h2>
<table>
<thead>
<tr>
<th>åŒ¹é…è§„åˆ™</th>
<th>ä¼˜å…ˆçº§</th>
</tr>
</thead>
<tbody>
<tr>
<td>=</td>
<td>ä¸¥æ ¼åŒ¹é…è¿™ä¸ªæŸ¥è¯¢ã€‚å¦‚æœæ‰¾åˆ°ï¼Œåœæ­¢æœç´¢ã€‚</td>
</tr>
<tr>
<td>^~</td>
<td>åŒ¹é…è·¯å¾„çš„å‰ç¼€ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåœæ­¢æœç´¢ã€‚</td>
</tr>
<tr>
<td>~</td>
<td>ä¸ºåŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…</td>
</tr>
<tr>
<td>~*</td>
<td>ä¸ºä¸åŒºåˆ†å¤§å°å†™åŒ¹é…</td>
</tr>
<tr>
<td>ä¼˜å…ˆçº§ï¼š</td>
<td>=, ^~, <sub>/</sub>*, æ— </td>
</tr>
</tbody>
</table>
<h2 id="breakè¯­å¥">breakè¯­å¥</h2>
<p>æ”¾åœ¨<code>server</code>å—<code>rewrite</code>è¯­å¥å‰é¢<br>
å¦‚æœæ˜¯ç›´æ¥è¯·æ±‚æŸä¸ªçœŸå®å­˜åœ¨çš„æ–‡ä»¶,åˆ™ç”¨breakè¯­å¥åœæ­¢rewriteæ£€æŸ¥</p>
<pre><code>if (-f $request_filename) { 
    break; 
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ‰£å‡åº“å­˜]]></title>
        <id>https://blog.cyanzoy.top/post/UL3LlJVMC</id>
        <link href="https://blog.cyanzoy.top/post/UL3LlJVMC">
        </link>
        <updated>2019-09-18T03:24:31.000Z</updated>
        <content type="html"><![CDATA[<!-- more -->
<p>ä½¿ç”¨CAS, <code>update table set v_1 = aa where id = xx and v_1 = old_v_1</code></p>
<blockquote>
<p>CAS â˜ compare/check and swap/set</p>
</blockquote>
<p>ä¸Šé¢çš„æ–¹æ¡ˆ,å¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªCASä¸­ç»å…¸é—®é¢˜. ABAçš„é—®é¢˜.</p>
<pre><code>ABAæ˜¯æŒ‡:
çº¿ç¨‹T1 æŸ¥è¯¢,åº“å­˜å‰©ä½™ Â 100
çº¿ç¨‹T2 æŸ¥è¯¢,åº“å­˜å‰©ä½™ Â 100
çº¿ç¨‹T1 æ‰§è¡Œsubupdate t set surplus = 90 where id = x and surplus = 100;
çº¿ç¨‹T3 æŸ¥è¯¢, åº“å­˜å‰©ä½™ 90
çº¿ç¨‹T3 æ‰§è¡Œadd Â update t set surplus = 100 where id = x and surplus = 90;
çº¿ç¨‹T2 æ‰§è¡Œsubupdate t set surplus = 90 where id = x and surplus = 100;
</code></pre>
<p>è¿™é‡Œçº¿ç¨‹T2æ‰§è¡Œçš„æ—¶å€™,åº“å­˜çš„100å·²ç»ä¸æ˜¯æŸ¥è¯¢åˆ°çš„100äº†<br>
ä¸€èˆ¬çš„è®¾è®¡ä¸­CASä¼šä½¿ç”¨versionæ¥æ§åˆ¶.</p>
<pre><code>update t set surplus = 90 ,version = version+1 where id = x and version = oldVersion;
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Git ç¬”è®°]]></title>
        <id>https://blog.cyanzoy.top/post/git-bi-ji</id>
        <link href="https://blog.cyanzoy.top/post/git-bi-ji">
        </link>
        <updated>2019-09-17T14:29:28.000Z</updated>
        <summary type="html"><![CDATA[<p>gitçš„ä¸€äº›å‘½ä»¤è®°å½•</p>
]]></summary>
        <content type="html"><![CDATA[<p>gitçš„ä¸€äº›å‘½ä»¤è®°å½•</p>
<!-- more -->
<p>ğŸ”¹Git æ·»åŠ è¿œç¨‹ä»“åº“å…³è”</p>
<pre><code>git remote add origin git@github.com:MAOA-L/AliPayApplet.git
git push -u origin master 
#è¿™å¥ä¸€èˆ¬ä¸ä¸Šå¥ä¸€èµ·ç”¨ã€‚ç”¨äºè¿œç¨‹ä»“åº“æ²¡æœ‰åˆå§‹åŒ–æ—¶
</code></pre>
<p>ğŸ”¸Git æœ¬åœ°åˆ†æ”¯å…³è”è¿œç¨‹åˆ†æ”¯</p>
<pre><code>git branch --set-upstream-to=origin/remote_branch  your_branch
</code></pre>
<p>ğŸ”¹Git åˆ é™¤æœ¬åœ°åˆ†æ”¯</p>
<pre><code>git branch -d [branchname]
</code></pre>
<p>ğŸ”¸Git åˆ é™¤è¿œç¨‹åˆ†æ”¯</p>
<pre><code>git push origin --delete [branchname]
</code></pre>
<blockquote>
<p><code>Q&amp;A</code><br>
ğŸ§: git branch ä¸æ˜¾ç¤ºåˆ†æ”¯åŸå› <br>
ğŸ¤ª: git branchè¦åœ¨git commitåæ‰ä¼šæ˜¾ç¤ºåˆ†æ”¯.<br>
ğŸ§:nginxçš„locationã€rootã€aliasæŒ‡ä»¤ç”¨æ³•å’ŒåŒºåˆ«<br>
ğŸ¤ª:</p>
</blockquote>
]]></content>
    </entry>
</feed>