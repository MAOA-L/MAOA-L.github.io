<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>uwsgi启动django服务+虚拟环境 | Sigma</title>
<meta name="description" content="为技术而生">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://www.cyanzoy.top/favicon.ico?v=1583990117331">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://www.cyanzoy.top/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150083328-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-150083328-1');
</script>


  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://www.cyanzoy.top">
        <img src="https://www.cyanzoy.top/images/avatar.png?v=1583990117331" class="site-logo">
        <h1 class="site-title">Sigma</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
        
          <a href="https://www.cyanzoy.top/post/fnyLymsmv/" class="site-nav" target="_blank">
            备忘录
          </a>
        
      
        
          <a href="https://www.cyanzoy.top/post/WdPSaRYzX/" class="site-nav" target="_blank">
            Menu
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/MAOA-L" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
          <a class="social-link" href="https://www.zhihu.com/people/chen-zhou-yun-15/activities" target="_blank">
            <i class="fab fa-zhihu"></i>
          </a>
        
      
        
      
    </div>
    <div class="site-description">
      为技术而生
    </div>
    <div class="site-footer">
      © 2019 CyanZoy | <a class="rss" href="https://www.cyanzoy.top/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">uwsgi启动django服务+虚拟环境</h2>
            <div class="post-date">2019-10-08</div>
            
              <div class="feature-container" style="background-image: url('https://www.cyanzoy.top/post-images/_7T3uDhTS.jpg')">
              </div>
            
            <div class="post-content">
              <p>脚本列表<br>
启动django服务用的Uwsgi的ini启动配置文件,启动脚本,自定义service脚本</p>
<!-- more -->
<h1 id="uwsgiini">uwsgi.ini</h1>
<pre><code class="language-ini"># uwsgi 配置文件
[uwsgi]
#端口
socket = 127.0.0.1:8000
# django项目绝对路径
chdir = /mnt/project/Blog/
# 模块路径（项目名称.wsgi）可以理解为wsgi.py的位置
module = Blog.wsgi
# 允许主进程
master = true
#最多进程数
processes  = 4
# 退出时候回收pid文件
vacuum = true
#日志大小配置500M
log-maxsize = 50000000
#记录日志配置
logto = /mnt/project/logs/Blog8000.log
pidfile = /mnt/project/logs/Blog8000.pid
daemonize = /mnt/project/logs/Blog/Blog.log
wsgi-file = /mnt/project/Blog/Blog/wsgi.py
virtualenv = /home/env/Blog_env
enable-threads = true
workers = 2
reload-mercy = 10
max-requests = 1000

#[uwsgi]
#socket = :8000
#master = true
#vhost = true
#gid = nginx
#uid = nginx
#no-stie = true
#enable-threads = true
#workers = 2
#reload-mercy = 10
#vacuum = true
#max-requests = 1000
#limit-as = 512
#buffer-sizi = 30000
#pidfile = /var/run/uwsgi8000diary.pid
#daemonize = /home/centos/project/logs/diary/uwsgi.log
#wsgi-file = /home/centos/project/diary/diary/wsgi.py
#chdir = /home/centos/project/diary
#module=diary.wsgi:application
#virtualenv = /usr/local/python3.7
#vacuum = True
</code></pre>
<h1 id="启动脚本-etcinitd">启动脚本 /etc/init.d/</h1>
<pre><code class="language-bash">#! /bin/sh
# chkconfig: 2345 55 25
# Description: Startup script for uwsgi webserver on Debian. Place in /etc/init.d and
# run 'update-rc.d -f uwsgi defaults', or use the appropriate command on your
# distro. For CentOS/Redhat run: 'chkconfig --add uwsgi'

### BEGIN INIT INFO
# Provides:          uwsgi
# Required-Start:    $all
# Required-Stop:     $all
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Short-Description: starts the uwsgi web server
# Description:       starts uwsgi using start-stop-daemon
### END INIT INFO

# Author:   licess
# website:  http://lnmp.org

PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/python3.7/bin
DESC=&quot;uwsgi daemon&quot;
NAME=uwsgi8000diary
DAEMON=/usr/bin/uwsgi
CONFIGFILE=/home/centos/project/confini/$NAME.ini
PIDFILE=/var/run/$NAME.pid
SCRIPTNAME=/etc/init.d/$NAME

set -e
[ -x &quot;$DAEMON&quot; ] || exit 0

do_start() {
    $DAEMON --ini $CONFIGFILE || echo -n &quot;uwsgi already running&quot;
}

do_stop() {
    $DAEMON --stop $PIDFILE || echo -n &quot;uwsgi not running&quot;
    rm -f $PIDFILE
    echo &quot;$DAEMON STOPED.&quot;
}

do_reload() {
    $DAEMON --reload $PIDFILE || echo -n &quot;uwsgi can't reload&quot;
}

do_status() {
    ps aux|grep $DAEMON
}

case &quot;$1&quot; in
 status)
    echo -en &quot;Status $NAME: \n&quot;
    do_status
 ;;
 start)
    echo -en &quot;Starting $NAME: \n&quot;
    do_start
 ;;
 stop)
    echo -en &quot;Stopping $NAME: \n&quot;
    do_stop
 ;;
 reload|graceful)
    echo -en &quot;Reloading $NAME: \n&quot;
    do_reload
 ;;
 *)
    echo &quot;Usage: $SCRIPTNAME {start|stop|reload}&quot; &gt;&amp;2
    exit 3
 ;;
esac

exit 0

</code></pre>
<h1 id="service-脚本-usrlibsystemdsystem">service 脚本 /usr/lib/systemd/system/</h1>
<pre><code class="language-ini">[Unit]
Documentation=man:systemd-sysv-generator(8)
SourcePath=/etc/rc.d/init.d/uwsgi9500_meetbuy
Description=LSB: starts the uwsgi web server
Before=runlevel2.target
Before=runlevel3.target
Before=runlevel4.target
Before=runlevel5.target
Before=shutdown.target
Before=agentwatch.service
After=all.target
After=network-online.target
Conflicts=shutdown.target

[Service]
Type=forking
Restart=no
TimeoutSec=5min
IgnoreSIGPIPE=no
KillMode=process
GuessMainPID=no
RemainAfterExit=yes
ExecStart=/etc/init.d/uwsgi9500_meetbuy start
ExecStop=/etc/init.d/uwsgi9500_meetbuy stop
ExecReload=/etc/init.d/uwsgi9500_meetbuy reload
</code></pre>
<h1 id="nginx中的配置">Nginx中的配置</h1>
<pre><code class="language-nginx">    server {
        listen       80;
        server_name  bus.cyanzoy.top;

        location / {
           include /usr/local/nginx/conf/uwsgi_params;
           uwsgi_pass 127.0.0.1:8000;

        }
        location /static {
            alias   /mnt/project/Blog/static/;
        }
    }
</code></pre>
<h1 id="最终脚本">最终脚本</h1>
<pre><code class="language-sh">#! /bin/sh

# 打开项目地址
cd /mnt/project/Blog
# 清空启动日志
echo &quot;&quot; &gt; /mnt/project/logs/Blog/Blog.log
# 更新项目
git pull origin master
# 重启uwsgi
systemctl stop Blog
systemctl start Blog
# 打开日志
tail -fn 20 /mnt/project/logs/Blog/Blog.log

</code></pre>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://www.cyanzoy.top/tag/WgJ98DRIP/" class="tag">
                    Service
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://www.cyanzoy.top/post/NzkqO5w9Y/">
                  <h3 class="post-title">
                    Nginx安装
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
