{"posts":[{"title":"Python中废弃方法的写法","content":"warnings.warn( &quot;'register_events' is deprecated since version 0.4.0. Please remove all references from your code.&quot;, DeprecationWarning, ) ","link":"https://www.cyanzoy.top/post/MQ4DAgJ2Z/"},{"title":"pip 命令","content":"pip 本地安装命令 #下载安装包 pip download 你的包名 -d &quot;下载的路径(windows下双引号来表示文件夹)&quot; 指定包获取路径 pip install --no-index --find-links=/path/to/package/ -r requirements.txt ","link":"https://www.cyanzoy.top/post/2Ly6WqToN/"},{"title":"备忘录","content":"预防老年痴呆,人人有责 宁波住建局项目查询网址 https://esf.cnnbfdc.com/ 关于服务器项目的一些备忘 项目虚拟环境统一放在 /home/env/ 下 自定义service放在 /usr/lib/systemd/system/ 目录下 运行脚本放在/etc/init.d/ 目录下 关于项目环境的一些备忘 source 进入python的虚拟环境后，直接运行deactivate退出虚拟环境 linux安装mysqlclient需要环境mysql-devel Address 陈周云 13857483191 宁波市鄞州区东柳街道桑田路锦苑东巷52号菜鸟驿站 陈周云 13857483191 宁波市鄞州区东柳街道樟树街106弄丹桂花园12号301 光猫 1、 移动光猫账号: CMCCAdmin 密码: aDm8H%MdA 2、 华为的：telecomadmin 密码：admintelecom 3、 中国移动光纤宽带ip：192.168.100.1的超级账号：telecomadmin 密码：nE7jA%5m centos 7 安装python 3.7.x 需要安装的依赖包yum -y install zlib zlib-devel yum -y install libffi-devel yum install mysql-devel frpc [common] server_addr = 34.84.188.25 server_port = 9000 privilege_token = sigma [google.frp] #privilege_mode = true type = http local_ip = 127.0.0.1 local_port = 80 # use_gzip = true custom_domains = gfrp.cyanzoy.top ;[ssh] ;type = tcp ;local_ip = 127.0.0.1 ;local_port = 22 ;remote_port = 6000 配置新的路由 route -p add 10.0.0.0 mask 255.0.0.0 10.203.68.254 if 15 metric 1 注:if后面的15表示的是有线网卡的序号 route -p add 0.0.0.0 mask 0.0.0.0 172.16.95.254 if 10 metric 2 注:if后面的10表示的是有线网卡的序号 route -p add 0.0.0.0 mask 0.0.0.0 172.20.10.1 route -p add [网络地址] mask [网络掩码] [网关地址] if [网卡序号] metric 跃点数 shadowsocks pip install shadowsocks LBEXDAFB07X495395 7B184064 ","link":"https://www.cyanzoy.top/post/fnyLymsmv/"},{"title":"九价-信息","content":"微信网址入口： https://wx.nbgzjk.cn/#/home 手机号 17858955387 预约网址： 月湖街道-九价 海曙第三医院-9价 海曙第三医院-4价 ","link":"https://www.cyanzoy.top/post/acghhaSlR/"},{"title":"九价预约流程-时间表","content":" 手机号 17858955387 微信网址入口： https://wx.nbgzjk.cn/#/home 手机号 17858955387 预约网址： 海曙第三医院 月湖街道 ","link":"https://www.cyanzoy.top/post/_XJ7mjKNk/"},{"title":"说明书备份","content":"ikbc87， ikbc87的说明书 ","link":"https://www.cyanzoy.top/post/ofCq4tNCT/"},{"title":"win10技巧","content":"Top1. 卓越模式 “卓越模式”需要手工激活，首先在管理员模式下运行Powershell，然后输入代码“powercfg -duplicatescheme e9a42b02-d5df-448d-aa00-03f14749eb61”。激活完成后，在Win10的电源计划里就会多出一项“卓越性能”，点击即可切换。 Top2. 上帝模式 “上帝模式”（God Mode）说白了，就是将所有设置全都放入到一个文件夹内，就像上帝一样，随心所欲进行任何操作。上帝模式也是一项隐藏功能，首先在桌面上建立一个文件夹，然后将文件夹重命名为“GodMode.{ED7BA470-8E54-465E-825C-99712043E01C}”。接下来再打开这个文件夹，就能看到所有你想看到的功能了。 ","link":"https://www.cyanzoy.top/post/ZDAnyZDWk/"},{"title":"🌷linux-问题记录","content":"pip安装时报【fatal error: Python.h: No such file or directory compilation terminated】错误 用pip安装第三方包的时候，有时候会遇到fatal error: Python.h: No such file or directory compilation terminated这样的报错。因为这些库使用了c扩展，需要编译，然后又找不到头文件和静态库导致的。编译这些c库需要的依赖库由python dev提供，安装即可： sudo yum install python-devel # for python2.x installs sudo yum install python34-devel # for python3.4 installs ","link":"https://www.cyanzoy.top/post/I9Yc7IbC1/"},{"title":"挑水果","content":" ","link":"https://www.cyanzoy.top/post/Z9HjxE7Ma/"},{"title":"笔记本双网卡实现内外网同时访问","content":"命令： route print 输出当前路由表的信息 route delete 192.x.x.x 删除路由 route -p add 192.0.0.0 mask 255.255.255.0 192.168.0.1 路由地址 掩码 网关 -p为永久，不加-p在重启后会失效 首先 连接上外网 连接上外网，此时路由表有0.0.0.0 的默认配置 然后另一张网卡连接内网 连接上内网后，配置ipv4 的地方不需要配置默认的网关 因为只能有一个网关地址 一个主机不能同时存在两个默认网关内网的网关通过命令加在路由上就可以了 此时 10的网会从10.0.0.0配置的走，其他的请求默认从0.0.0.0配置走 路由规则是先匹配明细路由，也就是说访问的时候电脑会先检测访问的是不是10.0.0.0的内网地址，如果是，就走内网，如果不是，就全部走默认路由到公网； ","link":"https://www.cyanzoy.top/post/BXAV9aBpF/"},{"title":"Supervisor","content":"1. 安装 建立软连接 yum install supervisor 2. supervisor 本身 项目 /etc/supervisord.conf 配置了 supervisor的基本配置文件， 取消[inet_http_server] 配置单元的注释 使用 supervisord -c /etc/supervisord.conf 或者supervisorctl -c /etc/supervisord.conf 启动supervisor，修改完配置文件之后，使用supervisorctl reload重启supervisor 3. super下的应用 ","link":"https://www.cyanzoy.top/post/6P5XXW1yl/"},{"title":"QQ安全中心 - 动态口令的生成算法","content":" 将当前北京时间向下对齐到30s，并按下面的格式格式化： yyyy-MM-dd HH:mm:ss 得到一个长度为19的octets，记为 timestamp。 例如，若当前北京时间为 2020-02-12 13:02:46，则向下对齐到30s，得到 timestamp 为： b'2020-02-12 13:02:30' 将 timestamp 添加到 secret 后面，并对新的octets做SHA256运算，得到长度为32的octets，记为 digest。 # digest = hashlib.sha256(secret + timestamp).digest() digest = b'\\x89\\x60\\xf9\\xeb\\x42\\x67\\x61\\x0e\\x74\\xc0\\x98\\x59\\x76\\x88\\xaf\\x6e\\x25\\xfb\\xf2\\x6b\\x6c\\xe3\\xbe\\x95\\x02\\xcb\\xed\\xd8\\x3e\\x0b\\xf9\\x44' 将 digest 的每个octet在原位分割成高四位和低四位，得到 digest_exp。digest_exp = [8, 9, 6, 0, 15, 9, 14, 11, 4, 2, 6, 7, 6, 1, 0, 14, 7, 4, 12, 0, 9, 8, 5, 9, 7, 6, 8, 8, 10, 15, 6, 14, 2, 5, 15, 11, 15, 2, 6, 11, 6, 12, 14, 3, 11, 14, 9, 5, 0, 2, 12, 11, 14, 13, 13, 8, 3, 14, 0, 11, 15, 9, 4, 4] 按照如下公式得到6位动态口令的每一位： ","link":"https://www.cyanzoy.top/post/o12oBvxY2/"},{"title":"蛋糕食谱","content":" 戚风蛋糕 水浴法 160℃ 50分钟 牛奶+油+糖 搅拌均匀 加热 微沸腾 加入粉（烫面，就是烫面粉，经过此步骤蛋糕组织会变得更细腻柔滑。）把面粉直接过筛倒奶锅里烫，拿蛋抽（小点的蛋抽，大了拌不到面粉）拿蛋抽快速的画两三圈搅拌至看不到干粉就停。 再以 Z型 手法快速的把面粉与液体彻底混合，使面团变得越来越光滑。 蛋黄分次混合；（扔蛋黄前一定要确认面团是否已经冷却或只剩一点余温，否则把蛋黄都烫熟了，蛋黄糊便会过于浓稠），用打蛋器以“Z型”手法把蛋黄和面团混合，不能画圈搅拌。 ","link":"https://www.cyanzoy.top/post/ygiNOLiCm/"},{"title":"story","content":" “你知道一块玻璃从楼上摔下来它会说什么嘛？” “说什么呀？” “晚安，我碎咯～” 睡不着，在数羊的时候，突然有一只小羊站了出来对我说 “请你用心一 点，你已经数过我一次了。” 睡前太懒不想关灯，随口到:“有鬼吗，帮忙关一下灯，请你吃冰激凌。啪的一声，灯灭了,我吓了一跳。黑暗中传来一个小小的声音:那...冰激凌要草莓味的可以嘛? 一只小熊走夜路，忽然感到屁股一凉，用手摸了摸发现尾巴不见了，可是回头却什么都没看到。 吓得小熊流了一身冷汗：是谁，是谁？！” 这时，空气中传来一个声音：“我是割尾鬼啊。” 有一只深海鱼在游泳，他越潜越深越潜越深，突然它就哭了起来，旁边的鱼觉得很奇怪就问他，“你干嘛哭啊？” 深海鱼说：“我压力好大”。 有一位病人来找精神科医师。病人：我一直觉得我是一只鸟。 医生：喔？那很严重喔，从什么时候开始的？ 病人：从我还是一只小鸟的时候。 男女朋友一起去逛街，女朋友：哎哟脚好酸哦。 男朋友很紧张：怎么了？是不是踩到柠檬了？ miss 没和我说话不觉得缺点什么吗 不和我聊天是怕我偷你表情包吗 吃坚果的时候突然会想，为什么不是你剥的 今天的奶茶没有那天和你一起喝的甜 如果想念有声音 我的邻居应该会投诉我吧 月亮只是喻体 所有的本体都指向你 麻溜的从我的脑袋里面滚出去 没办法专心了 此时相望不相闻 愿逐月华流照君 一个人喝奶茶的时候总感觉不够甜！！ 我们上一次见面是什么时候啊 不联系的日子里，你都在干什么 你在我才有草莓吃 我想吃草莓了 那夜的月亮特别美，我想不到可以告诉谁 你犹如我夜晚的困意酒后的温水 亦未来的生活 你家楼下的路灯让我问你要不要出来看月亮 今天的月亮又大又圆，你那里呢 今晚我心头的月亮又被你打翻了 你是不是在我心上撒了一把跳跳糖 连我都羡慕 你在我心里的位置 假如有人问我的烦忧 我不敢说出你的名字 也许你望着月亮时我正在想你 别人问我喜欢什么样的我又要开始形容你了 要脑子有什么用 它只会想你 把你位置发给我，看看我的心跑哪去了 我快写不出情话了 只想见你一面 昼赏微云,夜观星,醒也思卿,寐也思卿!可是思汝念汝不见汝! ","link":"https://www.cyanzoy.top/post/XTKTmzCa2/"},{"title":"📄Law","content":" 《旅游法》并非禁止购物和自费项目 根据《旅游法》第35条第二款的规定：“旅行社组织、接待旅游者，不得指定具体购物场所，不得安排另行付费旅游项目。但是，经双方协商一致或者旅游者要求，且不影响其他旅游者行程安排的除外。”这就是说，《旅游法》并非一概地、完全地和绝对地禁止在旅游活动中安排购物和自费项目，而是指不得由旅行社单方指定具体购物场所和任意安排另行付费旅游项目。如果经与旅游者双方协商一致，或者是旅游者主动要求，并且不影响其他旅游者的行程安排，旅行社仍然可以在旅游行程中安排一定的购物活动和自费项目。 因此，第一，旅游经营者不得有意或无意地曲解《旅游法》的这一规定，以《旅游法》禁止购物和自费项目为借口，为招徕游客，而随意宣传所谓“无购物、无自费、无小费”的“三无团”或纯玩团，并以此为由拒绝旅游者正当的购物和自费项目要求。 第二，在出境游组团活动中，组团社不能以《旅游法》禁止购物为借口，在旅游行程中拒绝安排旅游者提出的购物要求和自费项目。因为到境外旅游时，旅游者通常人生地不熟，多数人还与当地人语言不通，无法直接沟通。如果组团社没有预先安排，地接社根据旅游合同和行程安排，就很难在正常的旅游活动中安排这些购物或自费项目，其结果是必然会损害旅游者的正当权益。 ","link":"https://www.cyanzoy.top/post/NCUEDDgzr/"},{"title":"📜English Phrase","content":" You wish! 想的美 Not a chance! 休想! ","link":"https://www.cyanzoy.top/post/cLezMAaUT/"},{"title":"✍Celebrated dictum ","content":" 我野蛮生长，没能成为自己的月亮。 能遇见你 是银河慷慨赠予我的糖。 You are my today and all of tomorrows Cherish 小时候不理解老人晒太阳，一坐就是半天。长大了才明白，目之所及皆是回忆，心之所想皆是过往，眼之所看皆是遗憾。 李白写过那么多诗，他自己会背吗？” “像李白那么不羁的人，估计写完就忘，放不下的是我们俗人自己。” 村上春树有一句话“我告诉你我喜欢你，并不是一定要和你在一起，只是希望今后的你，在遭遇人生低谷的时候，不要灰心，至少曾经有人被你的魅力所吸引，曾经是，以后也会是” ","link":"https://www.cyanzoy.top/post/2fYlO0X9T/"},{"title":"🚢docker安装ce版本","content":"官网 https://docs.docker.com/v17.09/engine/installation/linux/docker-ce/centos/ Uninstall old versions Older versions of Docker were called docker or docker-engine. If these are installed, uninstall them, along with associated dependencies. $ sudo yum remove docker \\ docker-common \\ docker-selinux \\ docker-engine 方法一: Install using the repository SET UP THE REPOSITORY Install required packages. yum-utils provides the yum-config-manager utility, and device-mapper-persistent-data and lvm2 are required by the devicemapper storage driver. $ sudo yum install -y yum-utils \\ device-mapper-persistent-data \\ lvm2 Use the following command to set up the stable repository. You always need the stable repository, even if you want to install builds from the edge or test repositories as well. $ sudo yum-config-manager \\ --add-repo \\ https://download.docker.com/linux/centos/docker-ce.repo Optional: Enable the edge and test repositories. These repositories are included in the docker.repo file above but are disabled by default. You can enable them alongside the stable repository. $ sudo yum-config-manager --enable docker-ce-edge $ sudo yum-config-manager --enable docker-ce-test You can disable the edge or test repository by running the yum-config-manager command with the --disable flag. To re-enable it, use the --enable flag. The following command disables the edge repository. $ sudo yum-config-manager --disable docker-ce-edge Note: Starting with Docker 17.06, stable releases are also pushed to the edge and test repositories. Learn about stable and edge builds. INSTALL DOCKER CE Install the latest version of Docker CE, or go to the next step to install a specific version. $ sudo yum install docker-ce On production systems, you should install a specific version of Docker CE instead of always using the latest. List the available versions. This example uses the sort -r command to sort the results by version number, highest to lowest, and is truncated. $ yum list docker-ce --showduplicates | sort -r docker-ce.x86_64 17.09.ce-1.el7.centos docker-ce-stable $ sudo yum install &lt;FULLY-QUALIFIED-PACKAGE-NAME&gt; Start Docker. $ sudo systemctl start docker Verify that docker is installed correctly by running the hello-world image. $ sudo docker run hello-world 方法二: Install from a package Go to https://download.docker.com/linux/centos/7/x86_64/stable/Packages/ and download the .rpm file for the Docker version you want to install. Note: To install an edge package, change the word stable in the above URL to edge. Learn about stable and edge channels. Install Docker CE, changing the path below to the path where you downloaded the Docker package. $ sudo yum install /path/to/package.rpm Docker is installed but not started. The docker group is created, but no users are added to the group. Start Docker. $ sudo systemctl start docker Verify that docker is installed correctly by running the hello-world image. $ sudo docker run hello-world This command downloads a test image and runs it in a container. When the container runs, it prints an informational message and exits. UPGRADE DOCKER CE To upgrade Docker CE, download the newer package file and repeat the installation procedure, using yum -y upgrade instead of yum -y install, and pointing to the new file. ","link":"https://www.cyanzoy.top/post/46g2ELhQs/"},{"title":"🌾Python 异步编程asyncio模块","content":" asyncio 模块最大特点就是，只存在一个线程，跟 JavaScript 一样。 由于只有一个线程，就不可能多个任务同时运行。asyncio 是&quot;多任务合作&quot;模式(cooperative multitasking)，允许异步任务交出执行权给其他任务，等到其他任务完成，再收回执行权继续往下执行，这跟 JavaScript 也是一样的。 由于代码的执行权在多个任务之间交换，所以看上去好像多个任务同时运行，其实底层只有一个线程，多个任务分享运行时间。 表面上，这是一个不合理的设计，明明有多线程多进程的能力，为什么放着多余的 CPU 核心不用，而只用一个线程呢？但是就像前面说的，单线程简化了很多问题，使得代码逻辑变得简单，写法符合直觉。 asyncio 模块在单线程上启动一个事件循环(event loop)，时刻监听新进入循环的事件，加以处理，并不断重复这个过程，直到异步任务结束。事件循环的内部机制，可以参考 JavaScript 的模型，两者是一样的。 #!/usr/bin/env python3 # async.py # python3.7 及以上 import asyncio async def count(): print(&quot;One&quot;) await asyncio.sleep(1) print(&quot;Two&quot;) async def main(): await asyncio.gather(count(), count(), count()) asyncio.run(main()) ","link":"https://www.cyanzoy.top/post/LfH2aK5oT/"},{"title":"🌲Savitzky-Golay 滤波器","content":" ","link":"https://www.cyanzoy.top/post/ilNuF0noL/"},{"title":"🌳轨迹-异常值检测(三)","content":"LOF(Local Outlier Factor) 参考文章: 1.离群点检测算法——LOF(Local Outlier Factor) 2.异常检测(三)——Local Outlier Factor(LOF) ","link":"https://www.cyanzoy.top/post/YiNcentC2/"},{"title":"🌳轨迹-异常值检测(二)","content":"IsolationForest 参考文章: 1.异常检测（二）——IsolationForest ","link":"https://www.cyanzoy.top/post/xnOx4dk3D/"},{"title":"🌳轨迹-异常值检测(一)","content":"OneClassSVM 参考文章: 1.异常检测（一）——OneClassSVM ","link":"https://www.cyanzoy.top/post/XUaCLWFv_/"},{"title":"🌱Python的re模块中match、search、findall、finditer的区别","content":"温习python中的re模块 match 匹配string 开头,成功返回Match object, 失败返回None,只匹配一个。 search 在string中进行搜索,成功返回Match object, 失败返回None, 只匹配一个。 findall 在string中查找所有匹配成功的组, 即用括号括起来的部分。返回list对象，每个list item是由每个匹配的所有组组成的list。 finditer 在string中查找所有匹配成功的字符串, 返回iterator,每个item是一个Match object。 ","link":"https://www.cyanzoy.top/post/qMULWET8f/"},{"title":"IRR","content":" ","link":"https://www.cyanzoy.top/post/PZwpK-fkr/"},{"title":"Linux性能测试","content":"原文链接 https://blog.ilemonrain.com/linux/LemonBench.html 一、LemonBench 简单介绍 LemonBench目前涵盖了如下测试： 服务器基础信息 (CPU信息/内存信息/Swap信息/磁盘空间信息等) Speedtest网速测试 (本地到最近源及国内各地域不同线路的网速) 磁盘测试 (4K块/1M块 直接写入测试) 路由追踪测试 (追踪到国内和海外不同线路的路由信息) Spoofer测试 (获取详细网络信息，快速判断服务器接入线路) LemonBench使用起来非常简单，只需要复制粘贴再来个回车就可以轻松启动测试。 二、LemonBench 使用方法 1、快速测试 如果你的服务器上安装有 curl 工具，请使用以下命令执行脚本： curl -fsSL https://ilemonrain.com/download/shell/LemonBench.sh | bash -s fast 如果你的服务器上安装有 wget 工具，请使用以下命令执行脚本： wget -qO- https://ilemonrain.com/download/shell/LemonBench.sh | bash -s fast 2、完整测试 如果你的服务器上安装有 curl 工具，请使用以下命令执行脚本： curl -fsSL https://ilemonrain.com/download/shell/LemonBench.sh | bash -s full 如果你的服务器上安装有 wget 工具，请使用以下命令执行脚本： wget -qO- https://ilemonrain.com/download/shell/LemonBench.sh | bash -s full ","link":"https://www.cyanzoy.top/post/YQMzxqNFJ/"},{"title":"🌷linux-命令","content":"vim中的搜索 搜索方式： /word 下一个匹配 n 上一个匹配 N 第一个匹配处: ggn 最后一处 GN 自定义搜索 通过设置 hlsearch来高亮搜索结果:set hlsearch 使搜索不区分大小写 :set ignorecase 智能大小写搜索 :set ignorecase :set smartcase 递进搜索 :set incsearch 禁止环形搜索 :set nowrapscan 再次开启环形搜索 :set wrapscan 如果你想要搜索一个文件中的一个单词，但是又不想输入它，你只需要将你的光标移到这个单词下然后按 *(或者 shift + 8)。如果你想要启动一次部分搜索(例如:同时搜索 in 和 terminal)，那你需要将光标移到到单词下，然后通过在键盘上按 g* (按一次 g 然后不断按 * )。 另外:如果你想要逆向搜索，按 # 或者 g# 。 最后，假设你想要对文件中已经存在的单词做一点小小的修改，然后对修改后的单词执行搜索操作,一种方法是输入 / 与要搜索的单词。但是如果这个单词又长又复杂，那么可能需要一点时间来输入它。 一个方法是将光标移到你想要略微修改的单词下，按 / 之后再按 Ctrl + r 最后按 Ctrl + w。这个在光标下的单词不仅仅会被拷贝，也会被复制到 / 后，允许你对它进行修改并且继续进行搜索操作。 Linux - 查看进程 # 如果想查看某个进程的内存使用情况,使用top命令 # 以下为查看进程名为rviz状态命令 top -p `pidof rviz` # 为监控pid对应的进程 top -p pid # 用free命令查看虚拟内存。 free -h make clean 清除上次的make命令所产生的object文件（后缀为“.o”的文件）及可执行文件。 make distclean 类似make clean，但同时也将configure生成的文件全部删除掉，包括Makefile。 ","link":"https://www.cyanzoy.top/post/XQroA40u4/"},{"title":"uwsgi启动django服务+虚拟环境","content":"脚本列表 启动django服务用的Uwsgi的ini启动配置文件,启动脚本,自定义service脚本 uwsgi.ini # uwsgi 配置文件 [uwsgi] #端口 socket = 127.0.0.1:8000 # django项目绝对路径 chdir = /mnt/project/Blog/ # 模块路径（项目名称.wsgi）可以理解为wsgi.py的位置 module = Blog.wsgi # 允许主进程 master = true #最多进程数 processes = 4 # 退出时候回收pid文件 vacuum = true #日志大小配置500M log-maxsize = 50000000 #记录日志配置 logto = /mnt/project/logs/Blog8000.log pidfile = /mnt/project/logs/Blog8000.pid daemonize = /mnt/project/logs/Blog/Blog.log wsgi-file = /mnt/project/Blog/Blog/wsgi.py virtualenv = /home/env/Blog_env enable-threads = true workers = 2 reload-mercy = 10 max-requests = 1000 #[uwsgi] #socket = :8000 #master = true #vhost = true #gid = nginx #uid = nginx #no-stie = true #enable-threads = true #workers = 2 #reload-mercy = 10 #vacuum = true #max-requests = 1000 #limit-as = 512 #buffer-sizi = 30000 #pidfile = /var/run/uwsgi8000diary.pid #daemonize = /home/centos/project/logs/diary/uwsgi.log #wsgi-file = /home/centos/project/diary/diary/wsgi.py #chdir = /home/centos/project/diary #module=diary.wsgi:application #virtualenv = /usr/local/python3.7 #vacuum = True 启动脚本 /etc/init.d/ #! /bin/sh # chkconfig: 2345 55 25 # Description: Startup script for uwsgi webserver on Debian. Place in /etc/init.d and # run 'update-rc.d -f uwsgi defaults', or use the appropriate command on your # distro. For CentOS/Redhat run: 'chkconfig --add uwsgi' ### BEGIN INIT INFO # Provides: uwsgi # Required-Start: $all # Required-Stop: $all # Default-Start: 2 3 4 5 # Default-Stop: 0 1 6 # Short-Description: starts the uwsgi web server # Description: starts uwsgi using start-stop-daemon ### END INIT INFO # Author: licess # website: http://lnmp.org PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/python3.7/bin DESC=&quot;uwsgi daemon&quot; NAME=uwsgi8000diary DAEMON=/usr/bin/uwsgi CONFIGFILE=/home/centos/project/confini/$NAME.ini PIDFILE=/var/run/$NAME.pid SCRIPTNAME=/etc/init.d/$NAME set -e [ -x &quot;$DAEMON&quot; ] || exit 0 do_start() { $DAEMON --ini $CONFIGFILE || echo -n &quot;uwsgi already running&quot; } do_stop() { $DAEMON --stop $PIDFILE || echo -n &quot;uwsgi not running&quot; rm -f $PIDFILE echo &quot;$DAEMON STOPED.&quot; } do_reload() { $DAEMON --reload $PIDFILE || echo -n &quot;uwsgi can't reload&quot; } do_status() { ps aux|grep $DAEMON } case &quot;$1&quot; in status) echo -en &quot;Status $NAME: \\n&quot; do_status ;; start) echo -en &quot;Starting $NAME: \\n&quot; do_start ;; stop) echo -en &quot;Stopping $NAME: \\n&quot; do_stop ;; reload|graceful) echo -en &quot;Reloading $NAME: \\n&quot; do_reload ;; *) echo &quot;Usage: $SCRIPTNAME {start|stop|reload}&quot; &gt;&amp;2 exit 3 ;; esac exit 0 service 脚本 /usr/lib/systemd/system/ [Unit] Documentation=man:systemd-sysv-generator(8) SourcePath=/etc/rc.d/init.d/uwsgi9500_meetbuy Description=LSB: starts the uwsgi web server Before=runlevel2.target Before=runlevel3.target Before=runlevel4.target Before=runlevel5.target Before=shutdown.target Before=agentwatch.service After=all.target After=network-online.target Conflicts=shutdown.target [Service] Type=forking Restart=no TimeoutSec=5min IgnoreSIGPIPE=no KillMode=process GuessMainPID=no RemainAfterExit=yes ExecStart=/etc/init.d/uwsgi9500_meetbuy start ExecStop=/etc/init.d/uwsgi9500_meetbuy stop ExecReload=/etc/init.d/uwsgi9500_meetbuy reload Nginx中的配置 server { listen 80; server_name bus.cyanzoy.top; location / { include /usr/local/nginx/conf/uwsgi_params; uwsgi_pass 127.0.0.1:8000; } location /static { alias /mnt/project/Blog/static/; } } 最终脚本 #! /bin/sh # 打开项目地址 cd /mnt/project/Blog # 清空启动日志 echo &quot;&quot; &gt; /mnt/project/logs/Blog/Blog.log # 更新项目 git pull origin master # 重启uwsgi systemctl stop Blog systemctl start Blog # 打开日志 tail -fn 20 /mnt/project/logs/Blog/Blog.log ","link":"https://www.cyanzoy.top/post/_7T3uDhTS/"},{"title":"Nginx安装","content":"简介记录nginx的安装 需要的依赖环境 yum -y install pcre pcre-devel yum install openssl openssl-devel 编译 &amp;&amp; 安装 ./configure --prefix=/usr/local/nginx --with-http_ssl_module make &amp;&amp; make install 启动 nginx 重启 nginx -s reload 指定配置文件的启动 nginx -c /usr/local/nginx/conf/nginx.conf ","link":"https://www.cyanzoy.top/post/NzkqO5w9Y/"},{"title":"数据库 Mysql","content":"一系列命令 创建用户，授权，设更改加密模式 创建账号 CREATE USER 'username'@'host' IDENTIFIED BY 'password'; 授权 GRANT privileges ON databasename.tablename TO 'username'@'host' GRANT ALL ON databasename.* TO 'username'@'host' 说明: # privileges：用户的操作权限，如SELECT，INSERT，UPDATE等，如果要授予所的权限则使用ALL # databasename：数据库名 # tablename：表名，如果要授予该用户对所有数据库和表的相应操作权限则可用表示，如.* 注意: 用以上命令授权的用户不能给其它用户授权，如果想让该用户可以授权，用以下命令: GRANT privileges ON databasename.tablename TO 'username'@'host' WITH GRANT OPTION; 设置与更改用户密码 命令: SET PASSWORD FOR 'username'@'host' = PASSWORD('newpassword'); 如果是当前登陆用户用: SET PASSWORD = PASSWORD(&quot;newpassword&quot;); 例子: SET PASSWORD FOR 'pig'@'%' = PASSWORD(&quot;123456&quot;); 撤销用户权限 REVOKE privilege ON databasename.tablename FROM 'username'@'host'; 说明: privilege, databasename, tablename：同授权部分 例子: REVOKE SELECT ON *.* FROM 'pig'@'%'; 假如你在给用户 'pig'@ '%'授权的时候是这样的（或类似的）：GRANT SELECT ON test.user TO 'pig'@'%'，则在使用REVOKE SELECT ON . FROM 'pig'@'%';命令并不能撤销该用户对test数据库中user表的SELECT 操作。 同理，如果授权使用的是GRANT SELECT ON . TO 'pig'@'%';则REVOKE SELECT ON test.user FROM 'pig'@'%';命令也不能撤销该用户对test数据库中user表的Select权限。 具体信息可以用命令SHOW GRANTS FOR 'pig'@'%'; 查看。 删除用户 DROP USER 'username'@'host'; mysql8 加密方式不同，如有需要可运行下面这句进行更改 ALTER USER 'tone'@'%' IDENTIFIED WITH mysql_native_password BY '123456'; FLUSH PRIVILEGES; 数据库加解密sql fjarg3z30xtjcewyonjkkh6g7qub4tdei0dhu4bog 密钥 解密 SELECT AES_DECRYPT(UNHEX('已加密内容'), 'fjarg3z30xtjcewyonjkkh6g7qub4tdei0dhu4bog') 加密 SELECT HEX(AES_ENCRYPT('待加密内容', 'fjarg3z30xtjcewyonjkkh6g7qub4tdei0dhu4bog')) 其他 1.数据库目录 /var/lib/mysql/ 2.配置文件 /usr/share/mysql（mysql.server命令及配置文件）mysql5.5之后的默认安装路径，mysql5.5之前的是/usr/local/mysql 3.相关命令 /usr/bin(mysqladmin mysqldump等命令) 4.启动脚本 /etc/rc.d/init.d/（启动脚本文件mysql的目录） ","link":"https://www.cyanzoy.top/post/LfyAN6ymf/"},{"title":"后端必备 Nginx 配置","content":" 防盗链 根据文件类型设置过期时间 静态资源访问 ··· 日志配置 日志字段说明 access_log 访问日志 error_log 日志 日志切割 反向代理 禁止指定user_agent nginx访问控制 负载均衡 Nginx的rewrite 防盗链 location ~* \\.(gif|jpg|png)$ { # 只允许 192.168.0.1 请求资源 valid_referers none blocked 192.168.0.1; if ($invalid_referer) { rewrite ^/ http://$host/logo.png; } } 根据文件类型设置过期时间 location ~.*\\.css$ { expires 1d; break; } location ~.*\\.js$ { expires 1d; break; } location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf)$ { access_log off; expires 15d; #保存15天 break; } # curl -x127.0.0.1:80 http://www.test.com/static/image/common/logo.png -I # 测试图片的max-age 静态资源访问 http { # 这个将为打开文件指定缓存，默认是没有启用的，max 指定缓存数量， # 建议和打开文件数一致，inactive 是指经过多长时间文件没被请求后删除缓存。 open_file_cache max=204800 inactive=20s; # open_file_cache 指令中的inactive 参数时间内文件的最少使用次数， # 如果超过这个数字，文件描述符一直是在缓存中打开的，如上例，如果有一个 # 文件在inactive 时间内一次没被使用，它将被移除。 open_file_cache_min_uses 1; # 这个是指多长时间检查一次缓存的有效信息 open_file_cache_valid 30s; # 默认情况下，Nginx的gzip压缩是关闭的， gzip压缩功能就是可以让你节省不 # 少带宽，但是会增加服务器CPU的开销哦，Nginx默认只对text/html进行压缩 ， # 如果要对html之外的内容进行压缩传输，我们需要手动来设置。 gzip on; gzip_min_length 1k; gzip_buffers 4 16k; gzip_http_version 1.0; gzip_comp_level 2; gzip_types text/plain application/x-javascript text/css application/xml; server { listen 80; server_name www.test.com; charset utf-8; root /data/www.test.com; index index.html index.htm; } } 日志配置 日志字段说明 字段 解释 remote_addr 和 http_x_forwarded_for 客户端 IP 地址 remote_user 客户端用户名称 request 请求的 URI 和 HTTP 协议 status 请求状态 body_bytes_sent 返回给客户端的字节数，不包括响应头的大小 bytes_sent 返回给客户端总字节数 connection 连接的序列号 connection_requests 当前同一个 TCP 连接的的请求数量 msec 日志写入时间。单位为秒，精度是毫秒 pipe 如果请求是通过HTTP流水线(pipelined)发送，pipe值为&quot;p&quot;，否则为&quot;.&quot; http_referer 记录从哪个页面链接访问过来的 http_user_agent 记录客户端浏览器相关信息 request_length 请求的长度(包括请求行，请求头和请求正文) time_iso8601 ISO8601标准格式下的本地时间 time_local 记录访问时间与时区 access_log 访问日志 http { log_format access '$remote_addr - $remote_user [$time_local] $host &quot;$request&quot; ' '$status $body_bytes_sent &quot;$http_referer&quot; ' '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot; &quot;$clientip&quot;'; access_log /srv/log/nginx/talk-fun.access.log access; } error_log 日志 error_log /srv/log/nginx/nginx_error.log error; # error_log /dev/null; # 真正的关闭错误日志 http { # ... } 日志切割 # 和apache不同的是，nginx没有apache一样的工具做切割，需要编写脚本实现。# 在/usr/local/sbin下写脚本 #!/bin/bash dd=$(date -d '-1 day' +%F)[ -d /tmp/nginx_log ] || mkdir /tmp/nginx_log mv /tmp/nginx_access.log /tmp/nginx_log/$dd.log /etc/init.d/nginx reload &gt; /dev/null 反向代理 http { include mime.types; server_tokens off; ## 配置反向代理的参数 server { listen 8080; ## 1. 用户访问 http://ip:port，则反向代理到 https://github.com location / { proxy_pass https://github.com; proxy_redirect off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } ## 2.用户访问 http://ip:port/README.md，则反向代理到 ## https://github.com/zibinli/blog/blob/master/README.md location /README.md { proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass https://github.com/zibinli/blog/blob/master/README.md; } } } 禁止指定user_agent #虚拟主机的配置文件里加入： if ($http_user_agent ~* 'baidu|360|sohu') #禁止useragent为baidu、360和sohu，~*表示不区分大小写匹配 { return 403; } location / 和 location ~ / 优先级是不一样的。 结合这个文章研究一下吧 http://blog.itpub.net/27181165/viewspace-777202/ curl -A &quot;baidu&quot; -x127.0.0.1:80 www.test.com/forum.php -I 该命令指定百度为user_agent,返回403 nginx访问控制 # 可以设置一些配置禁止一些ip的访问 deny 127.0.0.1; #全局定义限制，location里的是局部定义的。如果两者冲突，以location这种精确地优先， location ~ .*admin\\.php$ { #auth_basic &quot;cct auth&quot;; #auth_basic_user_file /usr/local/nginx/conf/.htpasswd; allow 127.0.0.1; 只允许127.0.0.1的访问，其他均拒绝 deny all; include fastcgi_params; fastcgi_pass unix:/tmp/www.sock; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME /data/www$fastcgi_script_name; } 负载均衡 http { upstream test.net { ip_hash; server 192.168.10.13:80; server 192.168.10.14:80 down; server 192.168.10.15:8009 max_fails=3 fail_timeout=20s; server 192.168.10.16:8080; } server { location / { proxy_pass http://test.net; } } } Nginx的rewrite rewite 在server块下，会优先执行rewrite部分，然后才会去匹配location块 server中的rewrite break和last没什么区别，都会去匹配location，所以没必要用last再发起新的请求，可以留空 location中的rewirte： 不写last和break - 那么流程就是依次执行这些rewrite rewrite break - url重写后，直接使用当前资源，不再执行location里余下的语句，完成本次请求，地址栏url不变 rewrite last - url重写后，马上发起一个新的请求，再次进入server块，重试location匹配，超过10次匹配不到报500错误，地址栏url不变 rewrite redirect – 返回302临时重定向，地址栏显示重定向后的url，爬虫不会更新url（因为是临时） rewrite permanent – 返回301永久重定向, 地址栏显示重定向后的url，爬虫更新url 使用last会对server标签重新发起请求 如果location中rewrite后是对静态资源的请求，不需要再进行其他匹配，一般要使用break或不写，直接使用当前location中的数据源，完成本次请求 如果location中rewrite后，还需要进行其他处理，如动态fastcgi请求(.php,.jsp)等，要用last继续发起新的请求 (根的location使用last比较好, 因为如果有.php等fastcgi请求还要继续处理) 使用alias指定源：必须使用last if语句主要用来判断一些在rewrite语句中无法直接匹配的条件,比如检测文件存在与否,http header,cookie等 location匹配规则及优先级 匹配规则 优先级 = 严格匹配这个查询。如果找到，停止搜索。 ^~ 匹配路径的前缀，如果找到，停止搜索。 ~ 为区分大小写的正则匹配 ~* 为不区分大小写匹配 优先级： =, ^~, /*, 无 break语句 放在server块rewrite语句前面 如果是直接请求某个真实存在的文件,则用break语句停止rewrite检查 if (-f $request_filename) { break; } 记录 http { include mime.types; default_type application/octet-stream; #log_format main '$remote_addr - $remote_user [$time_local] &quot;$request&quot; ' # '$status $body_bytes_sent &quot;$http_referer&quot; ' # '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;'; #access_log logs/access.log main; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; server { listen 80; server_name www.cyanzoy.top; #charset koi8-r; #access_log logs/host.access.log main; location / { root /mnt/project/blog/MAOA-L.github.io/; rewrite ^/(.*) https://www.cyanzoy.top/$1 last; # index index.html index.htm; } location /styles { alias /mnt/project/blog/MAOA-L.github.io/styles/; } # 如果是做代理(django-uwsgi服务) location / { #root /usr/share/nginx/aichensmart; #index index.php index.html index.htm; include /etc/nginx/uwsgi_params; uwsgi_pass 127.0.0.1:port; } #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } server { listen 443 ssl; server_name www.cyanzoy.top; # ssl on; # root /mnt/project/blog/MAOA-L.github.io/; # index index.html index.htm; ssl_certificate /usr/local/nginx/cert/2880038_www.cyanzoy.top.pem; ssl_certificate_key /usr/local/nginx/cert/2880038_www.cyanzoy.top.key; ssl_session_timeout 5m; # ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; ssl_ciphers HIGH:!aNULL:!MD5; # ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_prefer_server_ciphers on; location / { root /mnt/project/blog/MAOA-L.github.io/; index index.html index.htm; } } } ","link":"https://www.cyanzoy.top/post/9XwZQILat/"},{"title":"扣减库存","content":" 使用CAS, update table set v_1 = aa where id = xx and v_1 = old_v_1 CAS ☞ compare/check and swap/set 上面的方案,可能会出现一个CAS中经典问题. ABA的问题. ABA是指: 线程T1 查询,库存剩余 100 线程T2 查询,库存剩余 100 线程T1 执行subupdate t set surplus = 90 where id = x and surplus = 100; 线程T3 查询, 库存剩余 90 线程T3 执行add update t set surplus = 100 where id = x and surplus = 90; 线程T2 执行subupdate t set surplus = 90 where id = x and surplus = 100; 这里线程T2执行的时候,库存的100已经不是查询到的100了 一般的设计中CAS会使用version来控制. update t set surplus = 90 ,version = version+1 where id = x and version = oldVersion; ","link":"https://www.cyanzoy.top/post/UL3LlJVMC/"},{"title":"Git 笔记","content":"git的一些命令记录 🔹Git 添加远程仓库关联 git remote add origin git@github.com:MAOA-L/AliPayApplet.git git push -u origin master #这句一般与上句一起用。用于远程仓库没有初始化时 🔸Git 本地分支关联远程分支 git branch --set-upstream-to=origin/remote_branch your_branch 🔹Git 删除本地分支 git branch -d [branchname] 🔸Git 删除远程分支 git push origin --delete [branchname] 🔹Git stash暂存,恢复,删除 暂存 git stash 保存当前工作进度，会把暂存区和工作区的改动保存起来。执行完这个命令后，在运行git status命令，就会发现当前是一个干净的工作区，没有任何改动。使用git stash save 'message...'可以添加一些注释 恢复 git stash pop [–index] [stash_id] git stash pop 恢复最新的进度到工作区。git默认会把工作区和暂存区的改动都恢复到工作区。 git stash pop --index 恢复最新的进度到工作区和暂存区。（尝试将原来暂存区的改动还恢复到暂存区） git stash pop stash@{1}恢复指定的进度到工作区。stash_id是通过git stash list命令得到的 通过git stash pop命令恢复进度后，会删除当前进度。 git stash apply [–index] [stash_id] 除了不删除恢复的进度之外，其余和git stash pop 命令一样。 删除 git stash drop [stash_id] 删除一个存储的进度。如果不指定stash_id，则默认删除最新的存储进度。 git stash clear 删除所有存储的进度。 Q&amp;A 🧐: git branch 不显示分支原因 🤪: git branch要在git commit后才会显示分支. 🧐:nginx的location、root、alias指令用法和区别 🤪: ","link":"https://www.cyanzoy.top/post/git-bi-ji/"}]}